{"version":3,"file":"emulateAnimationEnd.mjs","sources":["../../src/strings/animationEndEvent.ts","../../src/misc/emulateAnimationEnd.ts"],"sourcesContent":["/**\n * A global namespace for 'animationend' string.\n */\nconst animationEndEvent = 'animationend';\nexport default animationEndEvent;\n","import animationEndEvent from '../strings/animationEndEvent';\nimport getElementAnimationDelay from '../get/getElementAnimationDelay';\nimport getElementAnimationDuration from '../get/getElementAnimationDuration';\nimport dispatchEvent from './dispatchEvent';\n\n/**\n * Utility to make sure callbacks are consistently\n * called when animation ends.\n *\n * @param element target\n * @param handler `animationend` callback\n */\nconst emulateAnimationEnd = (element: HTMLElement, handler: EventListener): void => {\n  let called = 0;\n  const endEvent = new Event(animationEndEvent);\n  const duration = getElementAnimationDuration(element);\n  const delay = getElementAnimationDelay(element);\n\n  if (duration) {\n    /** Wrap the handler in on -> off callback */\n    const animationEndWrapper = (e: Event): void => {\n      /* istanbul ignore else */\n      if (e.target === element) {\n        handler.apply(element, [e]);\n        element.removeEventListener(animationEndEvent, animationEndWrapper);\n        called = 1;\n      }\n    };\n    element.addEventListener(animationEndEvent, animationEndWrapper);\n    setTimeout(() => {\n      /* istanbul ignore next */\n      if (!called) dispatchEvent(element, endEvent);\n    }, duration + delay + 17);\n  } else {\n    handler.apply(element, [endEvent]);\n  }\n};\n\nexport default emulateAnimationEnd;\n"],"names":[],"mappings":";;;;;;AAGA,MAAM,iBAAoB,GAAA,cAAA;;ACSpB,MAAA,mBAAA,GAAsB,CAAC,OAAA,EAAsB,OAAiC,KAAA;AAClF,EAAA,IAAI,MAAS,GAAA,CAAA,CAAA;AACb,EAAM,MAAA,QAAA,GAAW,IAAI,KAAA,CAAM,iBAAiB,CAAA,CAAA;AAC5C,EAAM,MAAA,QAAA,GAAW,4BAA4B,OAAO,CAAA,CAAA;AACpD,EAAM,MAAA,KAAA,GAAQ,yBAAyB,OAAO,CAAA,CAAA;AAE9C,EAAA,IAAI,QAAU,EAAA;AAEZ,IAAM,MAAA,mBAAA,GAAsB,CAAC,CAAmB,KAAA;AAE9C,MAAI,IAAA,CAAA,CAAE,WAAW,OAAS,EAAA;AACxB,QAAA,OAAA,CAAQ,KAAM,CAAA,OAAA,EAAS,CAAC,CAAC,CAAC,CAAA,CAAA;AAC1B,QAAQ,OAAA,CAAA,mBAAA,CAAoB,mBAAmB,mBAAmB,CAAA,CAAA;AAClE,QAAS,MAAA,GAAA,CAAA,CAAA;AAAA,OACX;AAAA,KACF,CAAA;AACA,IAAQ,OAAA,CAAA,gBAAA,CAAiB,mBAAmB,mBAAmB,CAAA,CAAA;AAC/D,IAAA,UAAA,CAAW,MAAM;AAEf,MAAA,IAAI,CAAC,MAAA;AAAQ,QAAA,aAAA,CAAc,SAAS,QAAQ,CAAA,CAAA;AAAA,KAC9C,EAAG,QAAW,GAAA,KAAA,GAAQ,EAAE,CAAA,CAAA;AAAA,GACnB,MAAA;AACL,IAAA,OAAA,CAAQ,KAAM,CAAA,OAAA,EAAS,CAAC,QAAQ,CAAC,CAAA,CAAA;AAAA,GACnC;AACF;;;;"}